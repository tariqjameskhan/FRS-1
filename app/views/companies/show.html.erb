
<div class="container mt-5">
  <h1><%= @company.name %></h1>

    <%= form_with(model: @company, local: true) do |form| %>
      <% if @company.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@company.errors.count, "error") %> prohibited this post from being saved:</h2>
          <ul>
          <% @company.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>
        <div class="d-inline-flex justify-content-between ms-5 p-3 mt-5">
          <div class="col-md-12">
            <div class="form-group textOnInput mt-3">
              <%= form.label :name, "Company Name" %>
              <%= form.text_field :name, class: "free-text-input-big", readonly: true %>
            </div>
            <div class="form-group textOnInput mt-3">
              <%= form.label :email_address %>
              <%= form.text_field :email_address, class: "free-text-input-big", readonly: true  %>
            </div>
            <div class="form-group textOnInput mt-3">
              <%= form.label :telephone_number %>
              <%= form.text_field :telephone_number, class: "free-text-input-big", readonly: true %>
            </div>
            <div class="form-group textOnInput mt-3">
              <%= form.label :address %>
              <%= form.text_field :address, class: "free-text-input-big", readonly: true %>
            </div>
          </div>
          <div class="map col-md-4" data-controller="map"
            id="map"
            data-map-markers-value="<%= @markers.to_json %>"
            data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
            style="margin-left: 20px;"
            >
          </div>
        </div>
        <%# <div class="actions"> %>
          <%# <%= form.submit class: "btn"%>
        <%# </div> %>
    <% end %>
  <div class="d-flex justify-content-between">
    <% if current_user.inspector? %>
        <%= link_to 'Delete', company_path(@company), data: {turbo_method: :delete, turbo_confirm: 'Are you sure?' }, class: 'btn-big-dark' %>

        <%= link_to 'Edit Company', edit_company_path(@company), class: 'btn-big' %>
    <% end %>
  </div>
  </div>
  <div class="container mt-5">
  <h2>Reports</h2>
  <div class="row">
    <table class="table table-striped mt-5">
      <thead>
        <tr>
          <th scope="col">*</th>
          <th scope="col">Premises name</th>
          <th scope="col">Premises address</th>
          <th scope="col">Tel</th>
          <th scope="col">Date Completed</th>
          <th scope="col"></th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <% num = 0 %>
        <% @company.reports.each do |report| %>
          <tr>
            <th scope="row"><%= num += 1 %></th>
            <td><%= report.premises_name %></td>
            <td><%= report.street_address %></td>
            <td><%= report.telephone_number %></td>
            <td><%= report.date_report_completed %></td>
            <% if current_user.inspector? %>
            <td><%= link_to 'Edit', edit_company_report_path(@company, report), class: "btn"%></td>
            <% else %>
            <td></td>
            <% end %>
            <td><%= link_to 'View', company_report_path(@company, report), class: "btn"%></td>
            <td><%= link_to '<i class="fas fa-trash"></i>'.html_safe, company_report_path(@company, report), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "delete-button" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-between mt-4">
    <div>
      <%= link_to 'Back to Companies', companies_path, class: 'btn-big-dark' %>
    </div>
    <div class="justify-content-end">
      <% if current_user.inspector? %>
        <%= link_to 'Create report', new_company_report_path(@company), class: 'btn-big' %>
      <% end %>
    </div>
  </div>
</div>
